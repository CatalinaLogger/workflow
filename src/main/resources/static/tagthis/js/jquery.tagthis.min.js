/*!
    jQuery Tag This
    Copyright 2014 Dan Gribbin - dangribbin@gmail.com

    Licensed under the MIT license:
    http://www.opensource.org/licenses/mit-license.php

    Hat tip to jQuery Tags Input Plugin by XOXCO, Inc.

*/
!function(a){"use strict";var b,c,d=[],e=[],f=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a.fn.tagThis=function(f){var g=jQuery.extend({interactive:!0,defaultText:"type to tag",createTagWith:",",hideOriginal:!0,noDuplicates:!1,removeWithBackspace:!0,regex:"",maxChars:0,maxTags:0,width:"300px",height:"100px"},f);return this.each(function(){a(this).data("settings",g),g.hideOriginal&&a(this).hide();var b=a(this).attr("id");(!b||e[a(this).attr("id")])&&(b=a(this).attr("id","tags"+(new Date).getTime()).attr("id"));var f=jQuery.extend({wrapper:"#tag-this--"+b,realInput:"#"+b,fakeInput:"#"+b+"--tag"},g);e[b]=f.createTagWith,g.callbacks&&(g.callbacks.beforeAddTag||g.callbacks.afterAddTag||g.callbacks.onChange||g.callbacks.afterRemoveTag||g.callbacks.beforeRemoveTag||g.callbacks.errors)&&(d[b]=[],d[b].beforeAddTag=g.callbacks.beforeAddTag,d[b].afterAddTag=g.callbacks.afterAddTag,d[b].afterRemoveTag=g.callbacks.afterRemoveTag,d[b].onChange=g.callbacks.onChange,d[b].beforeRemoveTag=g.callbacks.beforeRemoveTag,d[b].errors=g.callbacks.errors);var h='<div id="tag-this--'+b+'" class="tag-this"><div id="'+b+'--addTag">';if(g.email&&a(this).data("type","email"),g.interactive&&(h=h+'<input id="'+b+'--tag" value="" data-default="'+g.defaultText+'" />'),h+='</div><div class="tag-this--clear"></div></div><div class="tag-this--error"></div>',a(h).insertAfter(this),g.interactive){var i=a(f.fakeInput),j=a(f.realInput);if(c=i.css("width"),i.val(i.attr("data-default")),a(f.wrapper).on("click",f,function(b){a(b.data.fakeInput).focus()}),i.on("focus",f,function(b){var c=a(b.data.fakeInput);c.val()===c.attr("data-default")&&c.val("")}),g.autocompleteSource){var k={source:g.autocompleteSource,select:function(a,b){a.preventDefault(),j.addTag(b.item.value),i.focus()}};if(!jQuery.ui.autocomplete)throw new Error("jQuery-Tag-This is missing the jQuery UI dependecy needed for autocomplete to work. If you don't need autocomplete, don't set the autocompleteSource setting.");i.autocomplete(k)}i.on("blur",f,function(b){var c=a(this).attr("data-default"),d=a(b.data.fakeInput),e=d.val();return""!==d.val()&&d.val()!==c?a(b.data.realInput).addTag(e):d.val(d.attr("data-default")),!1}),i.on("keypress",f,function(b){var c=a(b.data.fakeInput),d=c.val();return a(this).autosizeInput(c),b.which===b.data.createTagWith.charCodeAt(0)||13===b.which?(b.preventDefault(),a(b.data.realInput).addTag(d),!1):void 0}),i.on("keyup",f,function(b){var c=a(b.data.fakeInput);a(this).autosizeInput(c)}),f.removeWithBackspace&&i.on("keydown",function(b){if(8===b.keyCode&&""===a(this).val()){b.preventDefault();var c=a(this).closest(".tag-this").find(".tag:last"),d=c.text(),e=c.data("id"),f=a(this).attr("id").replace(/--tag$/,""),g={id:e,text:d};a("#"+f).removeTag(g),a(this).removeClass("tag-this--invalid"),a(this).trigger("focus")}}),i.on("keydown",function(b){8===b.keyCode&&a(this).removeClass("tag-this--invalid")}),f.noDuplicates&&i.on("keydown",function(b){(8===b.keyCode||String.fromCharCode(b.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&a(this).removeClass("tag-this--invalid")})}}),f&&f.width&&f.height&&(b=a("#tag-this--"+this[0].id),a(b).css({width:f.width,height:f.height})),this},a.fn.addTag=function(b){var c=a(this).data("settings");return this.each(function(){var e,f,g,h,i=a(this).attr("id");a("#"+i+"--tag").removeClass("tag-this--invalid");var j=a(this).data("tags");f=j?j:[],c.callbacks&&d[i]&&d[i].beforeAddTag&&(g=d[i].beforeAddTag,h={context:a(this),tags:f,attemptedInput:b},g.call(this,h));var k=a(this).validateAddTag(b,c,f);if(k.tagIsInvalid)return e=a("#"+i+"--tag"),e.addClass("tag-this--invalid"),e.trigger("focus"),a(this).relayError(i,b,c,f,k.errors),!1;if(b){if(!b.id){var l=a.fn.tagThis.generateUniqueTagId(f);b={id:l,text:b}}a("<span>").addClass("tag").attr("data-id",b.id).append(a("<span>").text(b.text),a("<button>",{title:"Click to remove "+b.text,text:"x","class":"tag-this--remove-tag"}).on("click",function(){return a("#"+i).removeTag(b)})).insertBefore("#"+i+"--addTag"),f.push(b),a("#"+i+"--tag").val(""),a(this).data("tags",f),e=a("#"+i+"--tag"),e.trigger("focus"),a(this).resetInputSize(e),c.callbacks&&d[i]&&d[i].afterAddTag&&(g=d[i].afterAddTag,h={context:a(this),tags:f,addedInput:b},g.call(this,h)),d[i]&&d[i].onChange&&(g=d[i].onChange,h={context:a(this),tags:f,addedInput:b},g.call(this,h))}}),!1},a.fn.validateAddTag=function(b,c,d){var e,f,g={};if(g.maxTagsReached=!1,g.maxCharsReached=!1,g.failedCustomRegex=!1,g.emailIsInvalid=!1,g.isDuplicate=!1,c.regex&&!c.email&&!b.id){var h=a(this).failedCustomRegex(b,c);h&&(e=!0,g.failedCustomRegex=!0)}if(c.email){var i=a(this).emailIsInvalid(b);i&&(e=!0,g.emailIsInvalid=!0)}if(c.noDuplicates){var j=a(this).tagExists(c,b);j===!0&&(e=!0,g.isDuplicate=!0)}if(c.maxTags&&c.maxTags===d.length&&(e=!0,g.maxTagsReached=!0),c.maxChars>0){var k=!1;k=b.id?b.text.length>c.maxChars:b.length>c.maxChars,k&&(g.maxCharsReached=!0,e=!0)}return f={tagIsInvalid:e,errors:g}},a.fn.removeTag=function(b){return this.each(function(){var c,e,f,g=a(this).attr("id");if(d[g]&&d[g].beforeRemoveTag&&(c=d[g].beforeRemoveTag,e={context:a(this),tags:f,inputToBeRemoved:b},c.call(this,e)),f=a(this).data("tags")){if(b.id){a("#tag-this--"+g+' .tag[data-id="'+b.id+'"]').remove();for(var h=0;h<f.length;h++)f[h].id===b.id&&f.splice(h,1)}else{a("#tag-this--"+g+" .tag").each(function(){a(this).find("span").text()===b&&a(this).remove()});for(var i=0;i<f.length;i++)f[i].text===b&&f.splice(i,1)}a(this).data("tags",f),f&&d[g]&&d[g].afterRemoveTag&&(c=d[g].afterRemoveTag,e={context:a(this),tags:f,removedInput:b},c.call(this,e)),d[g]&&d[g].onChange&&(c=d[g].onChange,e={context:a(this),tags:f,removedInput:b},c.call(this,e))}}),!1},a.fn.tagExists=function(b,c){var d=a(this).data("tags");if(!d)return!1;if(b.interactive||!c.id){for(var e=0;e<d.length;e++)if(d[e].text===c)return!0}else if(c.id)for(var f=0;f<d.length;f++)if(d[f].id===c.id)return!0;return!1},a.fn.autosizeInput=function(a){var b,c=a.width();a[0].scrollWidth-c>0&&(b=c+30),a.css("width",b)},a.fn.resetInputSize=function(a){a.css("width",c)},a.fn.emailIsInvalid=function(a){var b=f.test(a);return b?!1:!0},a.fn.failedCustomRegex=function(a,b){var c=b.regex,d=c.test(a);return d?!1:!0},a.fn.relayError=function(a,b,c,e,f){if(c.callbacks&&d[a]&&d[a].errors){var g={id:a,attemptedToTag:b,settings:c,tags:e,errors:f},h=d[a].errors;h.call(this,g)}},a.fn.clearAllTags=function(){var b,c=a(this).attr("id"),d=a("#tag-this--"+c),e=a("#"+c+"--tag"),f=d.parent().find(".tag-this--invalid");d.find(".tag").remove(),a(this).data("tags",""),f&&(b=f.data("default"),f.removeClass("tag-this--invalid").val(b),f.trigger("blur")),a(this).resetInputSize(e)},a.fn.tagThis.generateUniqueTagId=function(b){for(var c=1,d=7e3,e=Math.floor(Math.random()*(d-c+1))+c,f=0;f<b.length;f++)b[f].id===e&&1e3>f&&a(this).generateUniqueTagId();return e},a.fn.destroy=function(){a(this).next().remove(),a(this).show()},a.tagThisDestroyAll=function(){a(".tag-this").each(function(){a(this).prev().show(),a(this).remove()})}}(jQuery);